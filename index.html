<!DOCTYPE html><html>
<head>
  <title>Crypto Slot Machine</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      background: radial-gradient(circle, #222 0%, #111 100%);
      color: #fff;
      text-align: center;
    }
    .header {
      position: absolute;
      top: 10px;
      right: 10px;
      text-align: right;
    }
    .reel {
      display: inline-block;
      font-size: 40px;
      margin: 0 15px;
      width: 60px;
    }
    .win { color: #00ff00; font-weight: bold; }
    .lose { color: #ff3333; font-weight: bold; }
    .machine {
      border: 5px solid #888;
      padding: 20px;
      border-radius: 15px;
      background: #333;
      display: inline-block;
      box-shadow: 0 0 20px #000 inset;
      margin-top: 20px;
    }
    #payoutChart {
      margin-top: 20px;
      font-size: 18px;
    }
    #history {
      margin-top: 30px;
      width: 90%;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
    }
    .entry {
      font-size: 16px;
      margin: 4px 0;
      color: #ccc;
    }
    .hash {
      display: none;
      font-size: 12px;
      color: #888;
    }
    .show-hash {
      cursor: pointer;
      color: #0af;
      text-decoration: underline;
      margin-left: 8px;
      font-size: 14px;
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .modal {
      background: #333;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px #000;
      color: #fff;
      max-width: 300px;
      width: 80%;
      text-align: center;
    }
    .modal input {
      width: 100%;
      margin: 10px 0;
      padding: 8px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
    }
    .modal button {
      padding: 8px 16px;
      font-size: 16px;
      margin-top: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="header">
    <div id="playerInfo"></div>
    <button id="cashOutBtn" style="display:none;" onclick="cashOut()">Cash Out</button>
  </div>  <h1 style="color: gold; text-shadow: 2px 2px #000; margin-top: 60px;">Crypto Slot Machine</h1>  <div id="payoutChart">
    <h3>Payout Chart ($1 per spin)</h3>
    <p>Three 7's ‚Üí $5</p>
    <p>Three üíé ‚Üí $4</p>
    <p>Three üçí ‚Üí $3</p>
    <p>Three üçã ‚Üí $2</p>
    <p>Three üîî ‚Üí $1</p>
  </div>  <div class="machine">
    <div>
      <span class="reel" id="reel1">?</span>
      <span class="reel" id="reel2">?</span>
      <span class="reel" id="reel3">?</span>
    </div>
    <br>
    <button id="spinBtn" onclick="spin()" disabled>Pull Lever</button>
    <p id="result"></p>
    <p id="hash"></p>
  </div>  <div id="history">
    <h3>Pull History</h3>
    <div id="historyList"></div>
  </div>  <!-- Start Game Modal -->  <div id="startModal" class="modal-overlay">
    <div class="modal">
      <h2>Start Game</h2>
      <input id="playerNameInput" placeholder="Enter your name" />
      <input id="pullsInput" type="number" placeholder="Number of pulls" min="1" />
      <button onclick="startGame()">Start</button>
    </div>
  </div>  <!-- End Session Modal -->  <div id="endModal" class="modal-overlay" style="display:none;">
    <div class="modal">
      <h2>Game Over</h2>
      <p id="endMessage"></p>
      <button onclick="location.reload()">Play Again</button>
    </div>
  </div>  <script>
    const symbols = ['üçí', 'üçã', 'üîî', 'üíé', '7'];
    const payouts = { '7': 5, 'üíé': 4, 'üçí': 3, 'üçã': 2, 'üîî': 1 };
    const secret = 's3cr3t-k3y';

    let playerName = '';
    let balance = 0;
    let pullsLeft = 0;

    async function sha256(message) {
      const encoder = new TextEncoder();
      const data = encoder.encode(message);
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }

    function weightedRandomSymbol() {
      const weights = { '7': 0.01, 'üíé': 0.02, 'üçí': 0.04, 'üçã': 0.10, 'üîî': 0.15, 'other': 0.68 };
      const rand = Math.random();
      let cumulative = 0;
      for (let key in weights) {
        cumulative += weights[key];
        if (rand < cumulative) return key === 'other' ? symbols[Math.floor(Math.random() * symbols.length)] : key;
      }
      return symbols[Math.floor(Math.random() * symbols.length)];
    }

    function rand3() {
      return [
        symbols[Math.floor(Math.random() * symbols.length)],
        symbols[Math.floor(Math.random() * symbols.length)],
        symbols[Math.floor(Math.random() * symbols.length)]
      ];
    }

    function isWinCombo(arr) {
      return arr[0] === arr[1] && arr[1] === arr[2];
    }

    function startGame() {
      playerName = document.getElementById('playerNameInput').value.trim() || 'Player';
      pullsLeft = parseInt(document.getElementById('pullsInput').value) || 0;
      balance = pullsLeft;

      document.getElementById('startModal').style.display = 'none';
      document.getElementById('spinBtn').disabled = false;
      document.getElementById('cashOutBtn').style.display = 'inline-block';
      updatePlayerInfo();
    }

    function updatePlayerInfo() {
      document.getElementById('playerInfo').innerHTML =
        `${playerName}<br>Balance: $${balance.toFixed(2)}<br>Pulls Left: ${pullsLeft}`;
    }

    async function spin() {
      if (pullsLeft <= 0 || balance < 1) { cashOut(); return; }
      balance -= 1;
      pullsLeft -= 1;
      updatePlayerInfo();

      const rollType = weightedRandomSymbol();
      let result, win = false, payout = 0;

      if (payouts[rollType]) {
        result = [rollType, rollType, rollType];
        win = true;
        payout = payouts[rollType];
        balance += payout;
        updatePlayerInfo();
      } else {
        do { result = rand3(); } while (isWinCombo(result));
      }

      document.getElementById('reel1').textContent = result[0];
      document.getElementById('reel2').textContent = result[1];
      document.getElementById('reel3').textContent = result[2];

      const resultString = result.join('');
      const hash = await sha256(resultString + secret);
      document.getElementById('hash').textContent = 'Hash: ' + hash;
      location.hash = hash;

      document.getElementById('result').innerHTML = win
        ? `<span class="win">You WIN $${payout.toFixed(2)}!</span>`
        : `<span class="lose">Try Again!</span>`;

      const pullRecord = { symbols: resultString, hash: hash, win: win, payout: payout, time: new Date().toLocaleString() };
      saveToHistory(pullRecord);
      displayHistory();

      if (pullsLeft <= 0 || balance < 1) cashOut();
    }

    function saveToHistory(pull) {
      let history = JSON.parse(localStorage.getItem('slotHistory')) || [];
      history.unshift(pull);
      if (history.length > 20) history = history.slice(0, 20);
      localStorage.setItem('slotHistory', JSON.stringify(history));
    }

    function displayHistory() {
      const history = JSON.parse(localStorage.getItem('slotHistory')) || [];
      document.getElementById('historyList').innerHTML = history.map(entry =>
        `<div class="entry">` +
          `[${entry.time}] ${entry.symbols} - ` +
          `${entry.win ? `<span class="win">WIN $${entry.payout.toFixed(2)}</span>` : '<span class="lose">LOSE</span>'}` +
          `<span class="show-hash" onclick="this.nextElementSibling.style.display='inline'">Show Hash</span>` +
          `<span class="hash">${entry.hash}</span>` +
        `</div>`
      ).join('');
    }

    function cashOut() {
      document.getElementById('endMessage').textContent =
        `${playerName}, you cashed out with $${balance.toFixed(2)}`;
      document.getElementById('endModal').style.display = 'flex';
      document.getElementById('spinBtn').disabled = true;
      document.getElementById('cashOutBtn').style.display = 'none';
    }

    window.onload = function() {
      displayHistory();
    };
  </script></body>
</html>